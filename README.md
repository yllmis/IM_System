## 简介

这是一个用 Go 实现的简单命令行即时通讯服务器（IM），用于学习与演示 TCP 聊天服务器的基本概念。项目包含一个最小的服务器实现，支持用户上线/下线、查看在线用户以及更改用户名。

## 功能

- 用户连接后分配默认用户名为其远端地址（ip:port）。
- 在线广播消息（所有用户都能收到）。
- 支持命令：
  - `who`：查看当前在线用户列表。
  - `rename|新用户名`：修改当前用户名（必须用 `|` 分割）。

## 文件说明

- `main.go`：程序入口，创建并启动服务器。
- `sever.go`：服务器实现，负责监听连接、消息分发等。
- `user.go`：用户结构和对单个连接的处理逻辑。
- `go.mod`：Go 模块文件。

## 运行（Windows PowerShell）

在项目根目录（包含 `go.mod`）下运行：

```powershell
# 使用 go run 直接运行
go run .

# 或者构建后运行
go build -o im_server.exe .
./im_server.exe
```

程序默认监听地址：`127.0.0.1:5080`（可在 `main.go` 中修改）。

## 测试连接与使用示例

你可以使用 `telnet`、`nc` (netcat) 或其他 TCP 客户端连接到服务器：

```powershell
# 使用 telnet（windows 可能需要先启用 Telnet 客户端）
telnet 127.0.0.1 5080

# 使用 nc (如果已安装)
nc 127.0.0.1 5080
```

注意：服务器在读取客户端数据时会将读取的字节用 `n-2` 截断，这意味着客户端发送消息时需带换行（CR+LF）以结束一条消息（通常在 telnet 中按 Enter 即可）。

示例交互：

- 查询在线用户：发送 `who`，服务器会返回在线用户列表。
- 修改用户名：发送 `rename|Alice`，如果用户名可用，服务器会将你的用户名设置为 `Alice`。
- 广播消息：向服务器发送任意非命令文本，服务器会把该消息广播给所有在线用户。

## 注意与已知问题

- `rename` 命令的格式必须是 `rename|新用户名`，否则可能无法正确解析。
- 当前实现中没有持久化和鉴权，适用于学习和本地测试，不建议在不信任的网络环境中使用。

## 联系与授权

此代码用于学习与个人练习，按作者意愿使用。如需帮助或建议，可直接在仓库中提 issue。
